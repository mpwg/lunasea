# Development Setup

This guide covers setting up a development environment for LunaSea, including prerequisites, environment setup, and first build.

## Prerequisites

### Required Tools

**⚠️ IMPORTANT**: Always work from the `lunasea/` subdirectory, not the repository root. The main application is in the mono-repo's `lunasea/` folder.

```bash
cd lunasea/  # Always start here
```

#### Core Development Tools
- **Flutter SDK 3.0+**: Download from [flutter.dev](https://flutter.dev)
  - Verify: `flutter --version`
- **Dart SDK**: Included with Flutter
- **Node.js 20+**: For npm scripts 
  - Verify: `node --version`
- **npm 10+**: For package management
  - Verify: `npm --version`

#### Platform-specific Tools

**Android Development**
- Java 17 (OpenJDK recommended)
- Android SDK (via Android Studio)
- Set `JAVA_HOME` environment variable

**iOS/macOS Development** (macOS only)
- Xcode (latest stable version)
- Ruby with Bundler for Fastlane
- Command Line Tools: `xcode-select --install`

**Linux Development**
```bash
sudo apt-get install clang cmake ninja-build pkg-config libgtk-3-dev liblzma-dev
```

**Windows Development**
- Visual Studio with C++ tools
- Windows SDK

## Environment Setup

**⚠️ CRITICAL**: Run setup commands in the correct order to avoid failures:

```bash
cd lunasea/

# 1. Install Node dependencies first
npm install

# 2. Get Flutter dependencies  
flutter pub get

# 3. Generate required files (ALWAYS run before building)
npm run generate
```

### Common Setup Issues

**Husky Git Hook Errors**
If `npm install` fails with Husky errors in the mono-repo:
1. Run `npm install` from repository root first
2. Then retry in `lunasea/` directory

**Flutter Not Found**
- Ensure Flutter is in your PATH
- Run `flutter doctor` to verify installation

**Code Generation Failures**
- Code generation must complete successfully before any builds
- Check for syntax errors in Dart files if generation fails

## Code Generation (Required)

**⚠️ ALWAYS run code generation before building or making changes**:

```bash
npm run generate  # Generates all required files
```

### Individual Generation Commands

```bash
npm run generate:environment     # Environment config
npm run generate:build_runner    # JSON serialization, etc.
npm run generate:localization    # Language files  
npm run generate:assets          # Asset references
```

### Watch Mode for Development

```bash
npm run generate:build_runner:watch  # Auto-regenerates on file changes
```

## First Build

### Development Build
```bash
flutter run --debug  # Hot reload enabled
```

### Profile Build
```bash
npm run profile      # Profile mode with debugging
```

### Verify Setup
```bash
flutter doctor --verbose  # Check for issues
flutter analyze          # Run linter
```

## Development Workflow

### Daily Development
1. **Start**: `cd lunasea/`
2. **Update dependencies**: `flutter pub get`
3. **Generate code**: `npm run generate` (if needed)
4. **Start development**: `flutter run --debug`

### After Making Changes
1. **Lint**: `flutter analyze`
2. **Regenerate** (if modified JSON models): `npm run generate:build_runner`
3. **Test compilation**: `flutter run --debug`

### Committing Changes
```bash
npm run commit  # Interactive commit with Commitizen
```

## Generated Files (Never Edit Manually)

- `lib/**/*.g.dart` - Generated by build_runner
- `lib/system/environment.dart` - Environment configuration
- `assets/localization/*.json` - Localization files

## Build Times

**Development**: Instant hot reload
**Profile**: 2-5 minutes
**Release**: 5-15 minutes depending on platform

## Editor Setup

### VS Code (Recommended)
Extensions in `.vscode/extensions.json`:
- Dart
- Flutter
- GitLens
- Prettier

### Android Studio
- Install Flutter and Dart plugins
- Configure Flutter SDK path

## Troubleshooting

### Hot Reload Not Working
```bash
flutter run --debug  # Restart
```

### Asset Not Found Errors
```bash
npm run generate:assets
```

### Import Errors for Generated Files
Ensure code generation completed successfully:
```bash
npm run generate:build_runner
```

### Platform-specific Issues

**Android**
- Ensure Java 17 is installed and `JAVA_HOME` is set
- Check Android SDK installation

**iOS/macOS**
- Verify Xcode is up to date
- Install command line tools

**Linux**
- Install all required system dependencies
- Check GTK development packages

## Next Steps

- [Architecture Overview](Architecture-Overview) - Understand the codebase structure
- [Build Process](Build-Process) - Learn about release builds
- [Module System](Module-System) - Explore the modular architecture